version: "3.8"

networks:
  preprod:
     external: true  

volumes:
  db-data-release:
    external: true

services:
  db-release:
    image: ${BASE_IMG}/db/release:${DB_RELEASE_TAG}
    container_name: db-release
    volumes:
      - db-data-release:/data/db
    networks:
      - preprod
  api-release:
    image: ${BASE_IMG}/api/release:${API_RELEASE_TAG}
    links:
      - db:db-release
    container_name: api-release
    labels:
        - traefik.enable=true
        - traefik.http.routers.api.rule=Host(`api.dev.${DOMAIN_BASE}`)
        - traefik.http.routers.api.middlewares=myAdmin@docker
        - traefik.http.routers.api.entrypoints=websecure
        - traefik.http.routers.api.service=registry-web
        - traefik.http.services.api.loadbalancer.server.port=3000
    networks:
      - preprod